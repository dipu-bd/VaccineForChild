<form id="registerForm" method="post" action="javascript:null;">
    <div class="form-group">
        <label class="control-label">Username:</label>
        <input type="text" class="form-control" name="uname" placeholder="Your username">
    </div>

    <div class="form-group">
        <label class="control-label">Email address:</label>
        <input type="text" class="form-control" name="email" placeholder="Your Email address">
    </div>

    <div class="form-group">
        <label class="control-label">Password:</label>
        <input type="password" class="form-control" name="password" id="password" placeholder="Your Password">
    </div>
    <div class="form-group">
        <label class="control-label">Confirm Password:</label>
        <input type="password" class="form-control" name="passwd" placeholder="Confirm Password">
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="agree">
            I accept the <a href="/terms.html" target="_blank">Terms and Services</a>
        </label>
    </div>

    <div class="modal-footer">
        <!-- form output -->
        <div class="text-center text-info well-sm" id="error-box">
            <b>Just fill up the form and click Sign Up!</b>
        </div>
        <!-- modal buttons -->
        <input type="submit" class="btn btn-primary btn-block" value="Sign Up" id="signup-button"/>
    </div>
</form>

<script>
    (function () {
        var form = $('#registerForm');
        var errBox = $('#registerForm #error-box');
        var submitButton = $('#registerForm #signup-button');
        form.validate({
            submitHandler: function () {
                submitButton.text('Submitting...');
                submitButton.attr('disabled', true);
                $.post('/auth/register', form.serialize())
                        .done(function (result, status, jqXHR) {
                            if (result === 'OK') {
                                submitButton.text('Redirecting...');
                                window.location.href = '/';
                            } else {
                                errBox.text(result);
                            }
                        })
                        .error(function (result, status) {
                            console.log(result);
                            errBox.text('Connection Failed');
                        })
                        .always(function () {
                            submitButton.attr('disabled', false);
                        });
            },
            errorPlacement: function (error, element) {
                errBox.html(error);
            },
            rules: {
                uname: {
                    required: true,
                    minlength: 3,
                    maxlength: 35
                },
                email: {
                    required: true,
                    email: true
                },
                password: {
                    required: true,
                    minlength: 5,
                    maxlength: 25
                },
                passwd: {
                    required: true,
                    minlength: 5,
                    maxlength: 25,
                    equalTo: "#password"
                },
                agree: "required"
            },
            messages: {
                uname: {
                    required: "The username is required",
                    minlength: "Username should be at least 3 characters long",
                    maxlength: "Username should not have more than 35 characters"
                },
                password: {
                    required: "The password is required",
                    minlength: "Password should have at least 5 characters",
                    maxlength: "Password should not have more than 25 characters"
                },
                passwd: {
                    required: "The confirmation is required",
                    minlength: "Password should have at least 5 characters",
                    maxlength: "Password should not have more than 25 characters",
                    equalTo: "Please enter the same password as above"
                },
                email: "Please enter a valid email address",
                agree: "Please agree with our terms and services"
            }
        });
    })();
</script>